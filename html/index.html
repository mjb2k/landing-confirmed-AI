<html>
    <head>
        <meta charset="UTF-8">
        <title>Landing Confirmed Game</title>
        <style>
            body {
                background-color: red;
            }
        </style>
    </head>


    <body onload="init()">
        <script src="libraries/matter.js"></script>
        <script src="libraries/bodyRotateAroundPoint.js"></script>
        <script src="libraries/raycast.min.js"></script>
        <script src="main.js"></script>
        <script src="pp7.js"></script>

        <button onclick="addPlayer()"></button>
        <button onclick=""></button>
        <script>
            // this script tells us what a user is pressing.
            var map = {}; 
            onkeydown = onkeyup = function(e){
                map[e.keyCode] = e.type == 'keydown';
            }
        </script>
        <script>
            // this script is for the runner and calculating the relative position of the player
            // so that we don't overrotate the players gears, and keep up to date position
            // and much more.
            Matter.Events.on(runner, 'afterTick', function() {

                // issue commands to the ship based on what player is pressing.
                if (map[65] && !map[68]) { // A pressed down
                    player.leftThrust();
                }  
                else if (!map[65] && map[68]) { // D pressed down
                    player.rightThrust();
                }
                else if (map[65] && map[68]) { // both pressed down
                    player.fullThrust();
                }
                
                // a continuously updated distance for thrusterDelta
                var thrusterD = player.thrusterDelta();

                // look at whether the gears are all the way up, or all the way down
                var up = false, down;
                var deltaToGear = Matter.Vector.magnitude(Matter.Vector.sub(player.mainBody.position, player.leftGear.position));
                if (deltaToGear > 36.85 && deltaToGear < 37.05) {
                    up = true;
                }

                // if sufficiently far from the ground and the angle of 
                // our landing gears is not alright aligned we shall rotate them
                // to completely detract.
                if ((thrusterD > 100 || (thrusterD == -1)) && !up) {
                    player.retractGears();
                }

                // if sufficiently close and the angle of gears is not 
                // already extended then we shall extend them.
                else if (thrusterD < 100 && thrusterD != -1 && player.leftGear.angle > Math.PI/4 && thrusterD != -1) {
                    player.extendGears();
                }
            });
        </script>
    </body>

</html>